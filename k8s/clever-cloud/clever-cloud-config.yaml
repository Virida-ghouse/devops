# ☁️ VIRIDA Clever Cloud Kubernetes Configuration
# Configuration optimisée pour l'hébergement sur Clever Cloud

---
# Namespace VIRIDA System
apiVersion: v1
kind: Namespace
metadata:
  name: virida-system
  labels:
    name: virida-system
    purpose: infrastructure
    environment: clever-cloud
---
# Namespace VIRIDA Apps
apiVersion: v1
kind: Namespace
metadata:
  name: virida-apps
  labels:
    name: virida-apps
    purpose: applications
    environment: clever-cloud
---
# Namespace VIRIDA Monitoring
apiVersion: v1
kind: Namespace
metadata:
  name: virida-monitoring
  labels:
    name: virida-monitoring
    purpose: monitoring
    environment: clever-cloud
---
# Namespace ArgoCD
apiVersion: v1
kind: Namespace
metadata:
  name: argocd
  labels:
    name: argocd
    purpose: gitops
    environment: clever-cloud
---
# ConfigMap pour la configuration Clever Cloud
apiVersion: v1
kind: ConfigMap
metadata:
  name: clever-cloud-config
  namespace: virida-system
data:
  # Configuration Clever Cloud
  clever_cloud_domain: "${CC_APP_DOMAIN}"
  clever_cloud_region: "${CC_REGION}"
  clever_cloud_environment: "${CC_ENVIRONMENT}"
  
  # Configuration des ressources
  default_request_memory: "256Mi"
  default_request_cpu: "250m"
  default_limit_memory: "1Gi"
  default_limit_cpu: "1000m"
  
  # Configuration du monitoring
  prometheus_retention_days: "7"
  grafana_admin_password: "${GRAFANA_ADMIN_PASSWORD}"
  
  # Configuration de sécurité
  enable_network_policies: "true"
  enable_pod_security: "true"
  enable_rbac: "true"
---
# ServiceAccount pour VIRIDA
apiVersion: v1
kind: ServiceAccount
metadata:
  name: virida-admin
  namespace: virida-system
  labels:
    app.kubernetes.io/name: virida-admin
    app.kubernetes.io/part-of: virida
---
# ClusterRole pour VIRIDA
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: virida-admin
  labels:
    app.kubernetes.io/name: virida-admin
    app.kubernetes.io/part-of: virida
rules:
  - apiGroups: [""]
    resources: ["*"]
    verbs: ["*"]
  - apiGroups: ["apps"]
    resources: ["*"]
    verbs: ["*"]
  - apiGroups: ["networking.k8s.io"]
    resources: ["*"]
    verbs: ["*"]
  - apiGroups: ["rbac.authorization.k8s.io"]
    resources: ["*"]
    verbs: ["*"]
  - apiGroups: ["argoproj.io"]
    resources: ["*"]
    verbs: ["*"]
---
# ClusterRoleBinding pour VIRIDA
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: virida-admin-binding
  labels:
    app.kubernetes.io/name: virida-admin-binding
    app.kubernetes.io/part-of: virida
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: virida-admin
subjects:
  - kind: ServiceAccount
    name: virida-admin
    namespace: virida-system
---
# Network Policy par défaut pour VIRIDA Apps
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny
  namespace: virida-apps
  labels:
    app.kubernetes.io/name: default-deny
    app.kubernetes.io/part-of: virida
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
---
# Network Policy pour autoriser le monitoring
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-monitoring
  namespace: virida-apps
  labels:
    app.kubernetes.io/name: allow-monitoring
    app.kubernetes.io/part-of: virida
spec:
  podSelector: {}
  policyTypes:
    - Ingress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: virida-monitoring
      ports:
        - protocol: TCP
          port: 8080
        - protocol: TCP
          port: 9090
        - protocol: TCP
          port: 3000
---
# LimitRange pour VIRIDA Apps
apiVersion: v1
kind: LimitRange
metadata:
  name: virida-resource-limits
  namespace: virida-apps
  labels:
    app.kubernetes.io/name: virida-resource-limits
    app.kubernetes.io/part-of: virida
spec:
  limits:
    - type: Container
      default:
        memory: "1Gi"
        cpu: "1000m"
      defaultRequest:
        memory: "256Mi"
        cpu: "250m"
      max:
        memory: "4Gi"
        cpu: "2000m"
      min:
        memory: "128Mi"
        cpu: "100m"
---
# ResourceQuota pour VIRIDA Apps
apiVersion: v1
kind: ResourceQuota
metadata:
  name: virida-quota
  namespace: virida-apps
  labels:
    app.kubernetes.io/name: virida-quota
    app.kubernetes.io/part-of: virida
spec:
  hard:
    requests.cpu: "8"
    requests.memory: "16Gi"
    limits.cpu: "16"
    limits.memory: "32Gi"
    pods: "50"
    services: "20"
    persistentvolumeclaims: "20"
    configmaps: "50"
    secrets: "50"

